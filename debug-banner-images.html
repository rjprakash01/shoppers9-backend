<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banner Image Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-image {
            max-width: 300px;
            height: 200px;
            border: 2px solid #ddd;
            margin: 10px;
            object-fit: cover;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .log {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .image-container {
            display: inline-block;
            margin: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Banner Image Loading Debug Test</h1>
    
    <div class="test-section">
        <h2>Environment Variables Test</h2>
        <div id="env-test"></div>
    </div>

    <div class="test-section">
        <h2>Direct Image Loading Test</h2>
        <div id="direct-test"></div>
    </div>

    <div class="test-section">
        <h2>Fetch API Test</h2>
        <div id="fetch-test"></div>
    </div>

    <div class="test-section">
        <h2>CORS Headers Test</h2>
        <div id="cors-test"></div>
    </div>

    <div class="test-section">
        <h2>Image Error Simulation</h2>
        <div id="error-test"></div>
    </div>

    <div class="test-section">
        <h2>Console Logs</h2>
        <div id="console-logs" class="log"></div>
    </div>

    <script>
        // Console logging override
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('console-logs');
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            logContainer.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // Test data
        const testImages = [
            '/uploads/banners/image-1757661823038-9138485.svg',
            '/uploads/banners/image-1757661823038-9138486.svg',
            '/uploads/banners/nonexistent-image.svg'
        ];
        
        const adminBaseUrl = 'http://localhost:5001';
        const frontendUrl = 'http://localhost:5174';

        // Environment Variables Test
        function testEnvironmentVariables() {
            const envContainer = document.getElementById('env-test');
            
            // Simulate what the React app would see
            const viteApiUrl = 'http://localhost:3000'; // Default fallback
            const viteAdminApiUrl = 'http://localhost:5001'; // Default fallback
            
            envContainer.innerHTML = `
                <p><strong>VITE_API_URL:</strong> ${viteApiUrl}</p>
                <p><strong>VITE_ADMIN_API_URL:</strong> ${viteAdminApiUrl}</p>
                <p><strong>Admin Backend URL:</strong> ${adminBaseUrl}</p>
                <p><strong>Frontend URL:</strong> ${frontendUrl}</p>
            `;
            
            console.log('Environment variables configured');
        }

        // Direct Image Loading Test
        function testDirectImageLoading() {
            const container = document.getElementById('direct-test');
            
            testImages.forEach((imagePath, index) => {
                const fullUrl = adminBaseUrl + imagePath;
                const imageContainer = document.createElement('div');
                imageContainer.className = 'image-container';
                
                const img = document.createElement('img');
                img.src = fullUrl;
                img.className = 'test-image';
                img.alt = `Test Image ${index + 1}`;
                
                const label = document.createElement('p');
                label.textContent = `Image ${index + 1}: ${imagePath}`;
                
                const status = document.createElement('p');
                status.id = `status-${index}`;
                
                img.onload = function() {
                    status.textContent = 'Status: Loaded successfully';
                    status.className = 'success';
                    console.log(`Image loaded successfully: ${fullUrl}`);
                };
                
                img.onerror = function(error) {
                    status.textContent = 'Status: Failed to load';
                    status.className = 'error';
                    console.error(`Image failed to load: ${fullUrl}`, error);
                };
                
                imageContainer.appendChild(label);
                imageContainer.appendChild(img);
                imageContainer.appendChild(status);
                container.appendChild(imageContainer);
            });
        }

        // Fetch API Test
        async function testFetchAPI() {
            const container = document.getElementById('fetch-test');
            
            for (let i = 0; i < testImages.length; i++) {
                const imagePath = testImages[i];
                const fullUrl = adminBaseUrl + imagePath;
                
                try {
                    console.log(`Testing fetch for: ${fullUrl}`);
                    const response = await fetch(fullUrl, {
                        method: 'HEAD',
                        mode: 'cors'
                    });
                    
                    const resultDiv = document.createElement('div');
                    resultDiv.innerHTML = `
                        <p><strong>${imagePath}</strong></p>
                        <p class="${response.ok ? 'success' : 'error'}">
                            Status: ${response.status} ${response.statusText}
                        </p>
                        <p>Content-Type: ${response.headers.get('content-type') || 'Not specified'}</p>
                        <p>Access-Control-Allow-Origin: ${response.headers.get('access-control-allow-origin') || 'Not specified'}</p>
                        <hr>
                    `;
                    container.appendChild(resultDiv);
                    
                    console.log(`Fetch result for ${fullUrl}: ${response.status}`);
                } catch (error) {
                    const resultDiv = document.createElement('div');
                    resultDiv.innerHTML = `
                        <p><strong>${imagePath}</strong></p>
                        <p class="error">Fetch Error: ${error.message}</p>
                        <hr>
                    `;
                    container.appendChild(resultDiv);
                    
                    console.error(`Fetch error for ${fullUrl}:`, error);
                }
            }
        }

        // CORS Headers Test
        async function testCORSHeaders() {
            const container = document.getElementById('cors-test');
            
            try {
                const response = await fetch(adminBaseUrl + '/uploads/banners/image-1757661823038-9138485.svg', {
                    method: 'OPTIONS'
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('access-control-allow-origin'),
                    'Access-Control-Allow-Methods': response.headers.get('access-control-allow-methods'),
                    'Access-Control-Allow-Headers': response.headers.get('access-control-allow-headers'),
                    'Access-Control-Allow-Credentials': response.headers.get('access-control-allow-credentials')
                };
                
                container.innerHTML = `
                    <h3>CORS Preflight Response:</h3>
                    <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>
                `;
                
                console.log('CORS headers:', corsHeaders);
            } catch (error) {
                container.innerHTML = `<p class="error">CORS test failed: ${error.message}</p>`;
                console.error('CORS test error:', error);
            }
        }

        // Image Error Simulation
        function testImageErrorHandling() {
            const container = document.getElementById('error-test');
            
            // Test with placeholder image
            const placeholderImg = document.createElement('img');
            placeholderImg.src = '/placeholder-image.svg';
            placeholderImg.className = 'test-image';
            placeholderImg.alt = 'Placeholder Image';
            
            const placeholderContainer = document.createElement('div');
            placeholderContainer.className = 'image-container';
            placeholderContainer.innerHTML = '<p>Placeholder Image Test:</p>';
            placeholderContainer.appendChild(placeholderImg);
            
            placeholderImg.onload = () => {
                console.log('Placeholder image loaded successfully');
                const status = document.createElement('p');
                status.textContent = 'Placeholder: Loaded';
                status.className = 'success';
                placeholderContainer.appendChild(status);
            };
            
            placeholderImg.onerror = (error) => {
                console.error('Placeholder image failed to load:', error);
                const status = document.createElement('p');
                status.textContent = 'Placeholder: Failed';
                status.className = 'error';
                placeholderContainer.appendChild(status);
            };
            
            container.appendChild(placeholderContainer);
        }

        // Run all tests
        window.onload = function() {
            console.log('Starting banner image debug tests...');
            
            testEnvironmentVariables();
            testDirectImageLoading();
            testFetchAPI();
            testCORSHeaders();
            testImageErrorHandling();
            
            console.log('All tests initiated. Check results above.');
        };
    </script>
</body>
</html>